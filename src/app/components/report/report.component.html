
<div class="report-container">
  <div class="report-header">
    <h1 class="report-title">{{ isAdmin ? 'All Investors Report' : 'My Investment Report' }}</h1>
    <div class="header-buttons" *ngIf="!loading && !error && reports.length > 0">
      <button class="export-btn pdf-btn" (click)="exportAsPDF()">
        <span class="material-icons">picture_as_pdf</span>
        Export as PDF
      </button>
      <button class="export-btn excel-btn" (click)="exportAsExcel()">
        <span class="material-icons">table_chart</span>
        Export as Excel
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-message">
    <div class="loading-spinner">
      <div class="spinner"></div>
    </div>
    <h3>Loading Investment Data...</h3>
    <p>Please wait while we fetch your investment reports.</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-message">
    <div class="error-icon">
      <span class="material-icons">error</span>
    </div>
    <h3>Error Loading Data</h3>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="ngOnInit()">
      <span class="material-icons">refresh</span>
      Try Again
    </button>
  </div>

  <!-- No Data State -->
  <div *ngIf="!loading && !error && reports.length === 0" class="no-data-message">
    <div class="no-data-icon">
      <span class="material-icons">assessment</span>
    </div>
    <h3>No Investment Data Available</h3>
    <p>No investment data is currently available to generate reports. This could be due to:</p>
    <ul>
      <li>No investors have been added yet</li>
      <li>No transactions have been recorded</li>
      <li>Connection issues with the database</li>
    </ul>
  </div>

  <!-- Total Aggregation Section - Visible to Admin Only -->
  <div *ngIf="!loading && !error && reports.length > 0 && isAdmin" class="total-aggregation-card">
    <div class="aggregation-header">
      <h2 class="aggregation-title">Total Portfolio Summary</h2>
      <span class="aggregation-subtitle">All Investors Combined</span>
    </div>
    <div class="aggregation-stats">
      <div class="aggregation-stat principal">
        <div class="aggregation-icon">
          <span class="material-icons">account_balance</span>
        </div>
        <div class="aggregation-content">
          <h3>Total Principal</h3>
          <p class="aggregation-value">{{ totalPrincipal | currency:'INR':'symbol':'1.2-2' }}</p>
        </div>
      </div>
      <div class="aggregation-stat interest">
        <div class="aggregation-icon">
          <span class="material-icons">trending_up</span>
        </div>
        <div class="aggregation-content">
          <h3>Total Interest</h3>
          <p class="aggregation-value">{{ totalInterest | currency:'INR':'symbol':'1.2-2' }}</p>
        </div>
      </div>
      <div class="aggregation-stat capital">
        <div class="aggregation-icon">
          <span class="material-icons">savings</span>
        </div>
        <div class="aggregation-content">
          <h3>Total Grown Capital</h3>
          <p class="aggregation-value">{{ totalGrownCapital | currency:'INR':'symbol':'1.2-2' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- DESKTOP VERSION - Original Design -->
  <div *ngFor="let report of reports" class="report-card desktop-only">
    <div class="report-card-header">
      <h2 class="investor-name">{{ report.investorName }}</h2>
    </div>

    <div class="stats-grid">
      <div class="stat-card principal">
        <div class="stat-icon">
          <span class="material-icons">account_balance</span>
        </div>
        <div class="stat-content">
          <h3>Principal Amount</h3>
          <p class="stat-value">{{ report.principal | currency:'INR':'symbol':'1.2-2' }}</p>
        </div>
      </div>
      <div class="stat-card interest">
        <div class="stat-icon">
          <span class="material-icons">trending_up</span>
        </div>
        <div class="stat-content">
          <h3>Total Interest</h3>
          <p class="stat-value">{{ report.totalInterest | currency:'INR':'symbol':'1.2-2' }}</p>
          <div *ngIf="report.monthlyInterestBreakdown.length > 0" class="average-return">
            <small class="average-return-text">
              Average Return: {{ (report.averageReturnPercentage * 100).toFixed(2) }}%
            </small>
          </div>
        </div>
      </div>
      <div class="stat-card capital">
        <div class="stat-icon">
          <span class="material-icons">savings</span>
        </div>
        <div class="stat-content">
          <h3>Grown Capital</h3>
          <p class="stat-value">{{ report.grownCapital | currency:'INR':'symbol':'1.2-2' }}</p>
        </div>
      </div>
    </div>

    <div *ngIf="report.transactions.length > 0" class="transactions-section">
      <h3 class="section-title">Transaction History</h3>
      <div class="table-container">
        <table class="transactions-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th>Principal</th>
              <th>Interest</th>
              <th>Withdrawal</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let t of report.transactions">
              <td>{{ formatDate(t.date) }}</td>
              <td class="transaction-type">{{ t.type }}</td>
              <td class="amount principal-amount">
                <span *ngIf="t.type === 'invest' || t.type === 'deposit'">
                  {{ t.amount | currency:'INR':'symbol':'1.2-2' }}
                </span>
              </td>
              <td class="amount interest-amount">
                <span *ngIf="t.type === 'interest'">
                  {{ t.amount | currency:'INR':'symbol':'1.2-2' }}
                  <small class="interest-rate">({{ getTransactionInterestRate(t.date) }})</small>
                </span>
              </td>
              <td class="amount withdrawal-amount">
                <span *ngIf="t.type === 'withdraw'">
                  {{ t.amount | currency:'INR':'symbol':'1.2-2' }}
                </span>
              </td>
              <td class="amount balance-amount">{{ t.balance | currency:'INR':'symbol':'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="report.transactions.length === 0" class="no-transactions">
      <span class="material-icons">receipt_long</span>
      <p>No transactions found for this period.</p>
    </div>
  </div>

  <!-- MOBILE VERSION - New Design -->
  <div *ngFor="let report of reports" class="investment-report mobile-only">
    <!-- Investor Header -->
    <div class="investor-header">
      <h2 class="investor-name">{{ report.investorName }}</h2>
    </div>
    
    <!-- Initial Principal, Interest and Balance Card -->
    <div class="initial-card">
      <div class="principal-row">
        <div class="row-left">
          <span class="material-icons">account_balance</span>
          <span class="label">PRINCIPAL</span>
        </div>
        <span class="amount">{{ report.principal | currency:'INR':'symbol':'1.2-2' }}</span>
      </div>
      <div class="interest-row">
        <div class="interest-left">
          <div class="row-left">
            <span class="material-icons">trending_up</span>
            <span class="label">INTEREST</span>
          </div>
          <div class="avg-interest-rate" *ngIf="report.averageReturnPercentage > 0">
            <span class="rate-label">Avg Rate:</span>
            <span class="rate-value">{{ (report.averageReturnPercentage * 100).toFixed(2) }}%</span>
          </div>
        </div>
        <span class="amount">{{ report.totalInterest | currency:'INR':'symbol':'1.2-2' }}</span>
      </div>
      <div class="balance-row">
        <div class="row-left">
          <span class="material-icons">savings</span>
          <span class="label">BALANCE</span>
        </div>
        <span class="amount">{{ report.grownCapital | currency:'INR':'symbol':'1.2-2' }}</span>
      </div>
    </div>

    <!-- Transaction Cards -->
    <div *ngFor="let t of report.transactions" class="transaction-card" [ngClass]="t.type.toLowerCase()">
      <div class="transaction-header">
        <div class="transaction-date">{{ formatDate(t.date) }}</div>
        <div class="transaction-type">{{ t.type }}</div>
      </div>
      
      <div class="transaction-details">
        <div *ngIf="t.type === 'interest'" class="detail-row interest">
          <div class="detail-label">
            INTEREST
            <small class="interest-rate">({{ getTransactionInterestRate(t.date) }})</small>
          </div>
          <div class="detail-amount interest-amount">
            {{ t.amount | currency:'INR':'symbol':'1.2-2' }}
          </div>
        </div>
        <div *ngIf="t.type === 'withdraw'" class="detail-row withdrawal">
          <div class="detail-label">WITHDRAWAL</div>
          <div class="detail-amount withdrawal-amount">{{ t.amount | currency:'INR':'symbol':'1.2-2' }}</div>
        </div>
        <div *ngIf="t.type === 'invest' || t.type === 'deposit'" class="detail-row principal">
          <div class="detail-label">PRINCIPAL</div>
          <div class="detail-amount principal-amount">{{ t.amount | currency:'INR':'symbol':'1.2-2' }}</div>
        </div>
        <div class="detail-row balance">
          <div class="detail-label">BALANCE</div>
          <div class="detail-amount balance-amount">{{ t.balance | currency:'INR':'symbol':'1.2-2' }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Testing Component -->
</div>
